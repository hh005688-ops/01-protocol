<script>
    function parseCSV(csv) {
        // ä½¿ç”¨æ›´å¼·å¤§çš„æ­£å‰‡è¡¨é”å¼ä¾†è™•ç† CSV è£¡çš„é€—è™Ÿå•é¡Œï¼ˆä¾‹å¦‚ "1,237,630"ï¼‰
        const rows = csv.split('\n').map(row => {
            const matches = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
            return matches ? matches.map(m => m.replace(/"/g, '')) : row.split(',');
        });
        
        let assets = [];
        let totalDebt = 0;
        let fx = 31.44;

        // ðŸŽ¯ ç²¾æº–å°ç„¦å“¥çš„è©¦ç®—è¡¨æ¬„ä½
        rows.slice(1).forEach((row, index) => {
            if (row[0] && row[4] && index < 5) { // é™åˆ¶è®€å–å‰ 5 å€‹æ¨™çš„ (00675L åˆ° BOXX)
                assets.push({
                    code: row[0],
                    name: row[1],
                    price: parseFloat(row[3]) || 0,
                    shares: parseFloat(row[4]) || 0,
                    target: parseFloat(row[6]) || 0,
                    valueTWD: parseFloat(row[5]) || 0,
                    fx: parseFloat(row[2]) || 1
                });
            }
        });

        // ðŸŽ¯ æŠ“å– L2 ä½ç½®çš„ã€Œè³ªæŠ¼ç¸½å€Ÿæ¬¾ã€ (Row 1, Column 11)
        if (rows[1] && rows[1][11]) {
            totalDebt = parseFloat(rows[1][11].replace(/,/g, '')) || 0;
        }
        
        // ðŸŽ¯ æŠ“å– C3 é™„è¿‘çš„åŒ¯çŽ‡
        fx = parseFloat(rows[3][2]) || 31.44;

        updateUI(assets, totalDebt, fx);
    }
</script>
